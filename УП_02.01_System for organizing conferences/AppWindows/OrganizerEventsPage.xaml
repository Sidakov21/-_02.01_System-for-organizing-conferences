<Window x:Class="УП_02._01_System_for_organizing_conferences.AppWindows.OrganizerEventsPage"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:УП_02._01_System_for_organizing_conferences.AppWindows" xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="Управление мероприятиями" 
        FontFamily="Comic Sans MS"
        Icon="/Ресурсы/icon.ico">

    <Grid Background="#ABCFCE">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Панель управления -->
        <Border Grid.Row="0" Background="White" CornerRadius="10" 
                Margin="0,0,0,20" Padding="20">
            <StackPanel>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Поиск:" VerticalAlignment="Center" 
                                   Margin="0,0,10,0"/>
                        <TextBox x:Name="txtSearch" Width="300" 
                                 TextChanged="TxtSearch_TextChanged"/>

                        <TextBlock Text="Фильтр по дате:" VerticalAlignment="Center" 
                                   Margin="20,0,10,0"/>
                        <ComboBox x:Name="cmbDateFilter" Width="150" 
                                  SelectionChanged="CmbDateFilter_SelectionChanged">
                            <ComboBoxItem Content="Все даты"/>
                            <ComboBoxItem Content="Сегодня"/>
                            <ComboBoxItem Content="Завтра"/>
                            <ComboBoxItem Content="Эта неделя"/>
                            <ComboBoxItem Content="Этот месяц"/>
                            <ComboBoxItem Content="Прошедшие"/>
                            <ComboBoxItem Content="Будущие"/>
                        </ComboBox>

                        <TextBlock Text="Сортировка:" VerticalAlignment="Center" 
                                   Margin="20,0,10,0"/>
                        <ComboBox x:Name="cmbSortBy" Width="150" 
                                  SelectionChanged="CmbSortBy_SelectionChanged">
                            <ComboBoxItem Content="По дате (возр)"/>
                            <ComboBoxItem Content="По дате (убыв)"/>
                            <ComboBoxItem Content="По названию (А-Я)"/>
                            <ComboBoxItem Content="По названию (Я-А)"/>
                        </ComboBox>
                    </StackPanel>

                    <Button Grid.Column="1" Content="Создать мероприятие" 
                            Background="#546F94" Foreground="White"
                            Padding="15,8" FontWeight="Bold"
                            Click="BtnCreateEvent_Click"/>
                </Grid>
            </StackPanel>
        </Border>

        <!-- Список мероприятий -->
        <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Все мероприятия" 
                           FontSize="18" FontWeight="Bold" 
                           Foreground="#546F94" Margin="0,0,0,20"/>

                <ListView x:Name="lvEvents" Grid.Row="1">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Лого" Width="60">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Image Source="{Binding Логотип}" 
                                               Height="40" Width="40" 
                                               Stretch="Uniform"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Название" 
                                            DisplayMemberBinding="{Binding событие}" 
                                            Width="250"/>
                            <GridViewColumn Header="Дата" 
                                            DisplayMemberBinding="{Binding дата, StringFormat='dd.MM.yyyy'}" 
                                            Width="100"/>
                            <GridViewColumn Header="Город" 
                                            DisplayMemberBinding="{Binding Города.город}" 
                                            Width="150"/>
                            <GridViewColumn Header="Дни" 
                                            DisplayMemberBinding="{Binding дни}" 
                                            Width="80"/>
                            <GridViewColumn Header="Активности" Width="100">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Активности.Count}" 
                                                   HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Статус" Width="100">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding дата}" Value="{x:Static sys:DateTime.Today}">
                                                            <Setter Property="Text" Value="Сегодня"/>
                                                            <Setter Property="Foreground" Value="Orange"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding дата}" Value="{x:Static sys:DateTime.Today}">
                                                            <Setter Property="Text" Value="Завтра"/>
                                                            <Setter Property="Foreground" Value="Blue"/>
                                                        </DataTrigger>
                                                        <!--<DataTrigger Binding="{Binding дата, Converter={StaticResource DateToStatusConverter}}">
                                                            --><!-- Нужен конвертер для определения прошедших/будущих --><!--
                                                        </DataTrigger>-->
                                                    </Style.Triggers>
                                                    <Setter Property="Text" Value="Будущее"/>
                                                    <Setter Property="Foreground" Value="Green"/>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Действия" Width="200">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="Управлять" 
                                                    Background="#546F94" 
                                                    Foreground="White"
                                                    Padding="10,5" Margin="0,0,5,0"
                                                    Tag="{Binding ID_событие}"
                                                    Click="BtnManage_Click"/>
                                            <Button Content="✎" 
                                                    Background="#546F94" 
                                                    Foreground="White"
                                                    Width="30" Height="30"
                                                    Tag="{Binding ID_событие}"
                                                    Click="BtnEdit_Click"/>
                                            <Button Content="🗑" 
                                                    Background="Red" 
                                                    Foreground="White"
                                                    Width="30" Height="30"
                                                    Tag="{Binding ID_событие}"
                                                    Click="BtnDelete_Click"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>
        </Border>
    </Grid>
</Window>
